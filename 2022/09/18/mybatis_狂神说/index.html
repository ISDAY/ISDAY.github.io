
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0">
        <title>Mybatis_狂神说 | ISDAY</title>
        <meta name="author" content="ISDAY">
        <meta name="description" content="">
        <meta name="keywords" content="">
        <link rel="icon" href="avatar/avatar.png">
        <script src="https://cdn.staticfile.org/instant.page/5.1.0/instantpage.min.js" type="module"></script>
        <script src="https://cdn.staticfile.org/font-awesome/6.1.1/js/all.min.js"></script>
        
        <link rel="stylesheet" href="/css/fonts.min.css">
        <link rel="stylesheet" href="/css/particlex.css">
        
        <script src="https://cdn.staticfile.org/vue/3.2.33/vue.global.prod.min.js"></script>
    <meta name="generator" content="Hexo 6.3.0"></head>
    <body>
        <div id="loading" style="height:100vh;width:100vw;position:fixed;display:flex;z-index:200;justify-content:space-between;background:#fff;transition:opacity 0.3s ease-out"><div style="position:fixed;height:100vh;width:100vw;display:flex;justify-content:center;align-items:center"><div id="loadcontent" style="width:50vmin;height:50vmin;padding:50px;border-radius:50%;display:flex;justify-content:center;align-items:center;border:solid 10px #a3ddfb;text-align:center"><div><h2>LOADING...</h2><p style="word-break:keep-all">加载过慢请开启缓存(浏览器默认开启)</p><div><img alt="loading" src="/loading.gif"></div></div></div></div></div>
        <div id="layout">
            <i data-fa-symbol="calendar-solid" class="fa-solid fa-calendar fa-fw"></i>
            <i data-fa-symbol="bookmark-solid" class="fa-solid fa-bookmark fa-fw"></i>
            <i data-fa-symbol="tags-solid" class="fa-solid fa-tags fa-fw"></i>
            <transition name="into">
                <div v-show="show_page" style="display: -not-none">
                    <div id="menu_show">
                         
<nav id="menu">
    <div class="desktop-menu">
        <a href="/">
            <span class="title">ISDAY</span>
        </a>
        
        <a href="/">
            <i class="fa-solid fa-house fa-fw"></i>
            <span>&ensp;home</span>
        </a>
        
        <a href="/archives">
            <i class="fa-solid fa-box-archive fa-fw"></i>
            <span>&ensp;archives</span>
        </a>
        
        <a href="/categories">
            <i class="fa-solid fa-bookmark fa-fw"></i>
            <span>&ensp;categories</span>
        </a>
        
        <a href="/tags">
            <i class="fa-solid fa-tags fa-fw"></i>
            <span>&ensp;tags</span>
        </a>
        
    </div>
    <div :class="'phone-menu ' + menu_show" id="phone-menu">
        <div class="curtain" @click="menu_show = !menu_show" v-show="menu_show"></div>
        <div :class="'title'" @click="menu_show = !menu_show">
            <i class="fa-solid fa-bars fa-fw"></i>
            <span>&emsp;ISDAY</span>
        </div>
        <transition name="slide">
        <div class="items" v-show="menu_show">
            
            <a href="/">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-house fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">home</div>
                </div>
            </a>
            
            <a href="/archives">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-box-archive fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">archives</div>
                </div>
            </a>
            
            <a href="/categories">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-bookmark fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">categories</div>
                </div>
            </a>
            
            <a href="/tags">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-tags fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">tags</div>
                </div>
            </a>
            
        </div>
        </transition>
    </div>
</nav>
                    </div>
                    <div id="main">
                        
<div class="article">
    <div>
        <h1>Mybatis_狂神说 </h1>
    </div>
    <div class="info">
        <span class="date">
            <span class="icon">
                <svg class="fa-icon"><use xlink:href="#calendar-solid"></use></svg>
            </span>
            2022/9/18
        </span>
        
        <span class="category">
            <a href="/categories/SSM/">
                <span class="icon">
                    <svg class="fa-icon"><use xlink:href="#bookmark-solid"></use></svg>
                </span>
                SSM
            </a>
        </span>
        
        
        <span class="tags">
            <span class="icon">
                <svg class="fa-icon"><use xlink:href="#tags-solid"></use></svg>
            </span>
            
            <span class="tag">
                
                <a href="/tags/SSM/" style="color: #ff7d73">
                    SSM
                </a>
            </span>
            
            <span class="tag">
                
                <a href="/tags/MyBatis/" style="color: #00a596">
                    MyBatis
                </a>
            </span>
            
        </span>
        
    </div>
    <div class="content" v-pre>
        <h1 id="Mybatis-9-28"><a href="#Mybatis-9-28" class="headerlink" title="Mybatis-9.28"></a>Mybatis-9.28</h1><p>环境：</p>
<ul>
<li>JDK1.8</li>
<li>Mysql 5.7</li>
<li>maven 3.6.1</li>
<li>IDEA</li>
</ul>
<p>回顾：</p>
<ul>
<li>JDBC</li>
<li>Mysql</li>
<li>Java基础</li>
<li>Maven</li>
<li>Junit</li>
</ul>
<p>SSM框架：配置文件的。 最好的方式：看官网文档；</p>
<h2 id="1、简介"><a href="#1、简介" class="headerlink" title="1、简介"></a>1、简介</h2><h3 id="1-1、什么是Mybatis"><a href="#1-1、什么是Mybatis" class="headerlink" title="1.1、什么是Mybatis"></a>1.1、什么是Mybatis</h3><p><img src="https://cdn.jsdelivr.net/gh/ISDAY/FigureBed/mybatis-superbird-small.png" alt="img"></p>
<ul>
<li>MyBatis 是一款优秀的<strong>持久层框架</strong></li>
<li>它支持定制化 SQL、存储过程以及高级映射。</li>
<li>MyBatis 避免了几乎所有的 JDBC 代码和手动设置参数以及获取结果集。</li>
<li>MyBatis 可以使用简单的 XML 或注解来配置和映射原生类型、接口和 Java 的 POJO（Plain Old Java Objects，普通老式 Java 对象）为数据库中的记录。</li>
<li>MyBatis 本是<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/apache/6265">apache</a>的一个开源项目<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/iBatis">iBatis</a>, 2010年这个项目由apache software foundation 迁移到了google code，并且改名为MyBatis 。</li>
<li>2013年11月迁移到Github。</li>
</ul>
<p>如何获得Mybatis？</p>
<ul>
<li><p>maven仓库：</p>
<pre><code class="xml">&lt;!-- https://mvnrepository.com/artifact/org.mybatis/mybatis --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.mybatis&lt;/groupId&gt;
    &lt;artifactId&gt;mybatis&lt;/artifactId&gt;
    &lt;version&gt;3.5.2&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
</li>
<li><p>Github ： <a target="_blank" rel="noopener" href="https://github.com/mybatis/mybatis-3/releases">https://github.com/mybatis/mybatis-3/releases</a></p>
</li>
<li><p>中文文档：<a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/zh/index.html">https://mybatis.org/mybatis-3/zh/index.html</a></p>
</li>
</ul>
<h3 id="1-2、持久化"><a href="#1-2、持久化" class="headerlink" title="1.2、持久化"></a>1.2、持久化</h3><p>数据持久化</p>
<ul>
<li>持久化就是将程序的数据在持久状态和瞬时状态转化的过程</li>
<li>内存：<strong>断电即失</strong></li>
<li>数据库(Jdbc)，io文件持久化。</li>
<li>生活：冷藏. 罐头。</li>
</ul>
<p><strong>为什么需要需要持久化？</strong></p>
<ul>
<li>有一些对象，不能让他丢掉。</li>
<li>内存太贵了</li>
</ul>
<h3 id="1-3、持久层"><a href="#1-3、持久层" class="headerlink" title="1.3、持久层"></a>1.3、持久层</h3><p>Dao层，Service层，Controller层….</p>
<ul>
<li>完成持久化工作的代码块</li>
<li>层界限十分明显。</li>
</ul>
<h3 id="1-4-为什么需要Mybatis？"><a href="#1-4-为什么需要Mybatis？" class="headerlink" title="1.4 为什么需要Mybatis？"></a>1.4 为什么需要Mybatis？</h3><ul>
<li>帮助程序猿将数据存入到数据库中。</li>
<li>方便</li>
<li>传统的JDBC代码太复杂了。简化。框架。自动化。</li>
<li>不用Mybatis也可以。更容易上手。 <strong>技术没有高低之分</strong></li>
<li>优点：<ul>
<li>简单易学</li>
<li>灵活</li>
<li>sql和代码的分离，提高了可维护性。</li>
<li>提供映射标签，支持对象与数据库的orm字段关系映射</li>
<li>提供对象关系映射标签，支持对象关系组建维护</li>
<li>提供xml标签，支持编写动态sql。</li>
</ul>
</li>
</ul>
<p><strong>最重要的一点：使用的人多！</strong></p>
<p>Spring SpringMVC SpringBoot</p>
<h2 id="2、第一个Mybatis程序"><a href="#2、第一个Mybatis程序" class="headerlink" title="2、第一个Mybatis程序"></a>2、第一个Mybatis程序</h2><p>思路：搭建环境–&gt;导入Mybatis–&gt;编写代码–&gt;测试</p>
<h3 id="2-1、搭建环境"><a href="#2-1、搭建环境" class="headerlink" title="2.1、搭建环境"></a>2.1、搭建环境</h3><p>搭建数据库</p>
<pre><code class="sql">CREATE DATABASE `mybatis`;

USE `mybatis`;

CREATE TABLE `user`(
  `id` INT(20) NOT NULL PRIMARY KEY,
  `name` VARCHAR(30) DEFAULT NULL,
  `pwd` VARCHAR(30) DEFAULT NULL
)ENGINE=INNODB DEFAULT CHARSET=utf8;

INSERT INTO `user`(`id`,`name`,`pwd`) VALUES 
(1,&#39;狂神&#39;,&#39;123456&#39;),
(2,&#39;张三&#39;,&#39;123456&#39;),
(3,&#39;李四&#39;,&#39;123890&#39;)
</code></pre>
<p>新建项目</p>
<ol>
<li><p>新建一个普通的maven项目</p>
</li>
<li><p>删除src目录</p>
</li>
<li><p>导入maven依赖</p>
<pre><code class="xml">
    &lt;!--导入依赖--&gt;
    &lt;dependencies&gt;
        &lt;!--mysql驱动--&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;mysql&lt;/groupId&gt;
            &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;
            &lt;version&gt;5.1.47&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;!--mybatis--&gt;
        &lt;!-- https://mvnrepository.com/artifact/org.mybatis/mybatis --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.mybatis&lt;/groupId&gt;
            &lt;artifactId&gt;mybatis&lt;/artifactId&gt;
            &lt;version&gt;3.5.2&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;!--junit--&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;junit&lt;/groupId&gt;
            &lt;artifactId&gt;junit&lt;/artifactId&gt;
            &lt;version&gt;4.12&lt;/version&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
</code></pre>
</li>
</ol>
<h3 id="2-2、创建一个模块"><a href="#2-2、创建一个模块" class="headerlink" title="2.2、创建一个模块"></a>2.2、创建一个模块</h3><ul>
<li><p>编写mybatis的核心配置文件</p>
<pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;
&lt;!DOCTYPE configuration
        PUBLIC &quot;-//mybatis.org//DTD Config 3.0//EN&quot;
        &quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;&gt;
&lt;!--configuration核心配置文件--&gt;
&lt;configuration&gt;

    &lt;environments default=&quot;development&quot;&gt;
        &lt;environment id=&quot;development&quot;&gt;
            &lt;transactionManager type=&quot;JDBC&quot;/&gt;
            &lt;dataSource type=&quot;POOLED&quot;&gt;
                &lt;property name=&quot;driver&quot; value=&quot;com.mysql.jdbc.Driver&quot;/&gt;
                &lt;property name=&quot;url&quot; value=&quot;jdbc:mysql://localhost:3306/mybatis?useSSL=true&amp;amp;useUnicode=true&amp;amp;characterEncoding=UTF-8&quot;/&gt;
                &lt;property name=&quot;username&quot; value=&quot;root&quot;/&gt;
                &lt;property name=&quot;password&quot; value=&quot;mysql0917&quot;/&gt;
            &lt;/dataSource&gt;
        &lt;/environment&gt;
    &lt;/environments&gt;

&lt;/configuration&gt;
</code></pre>
</li>
<li><p>编写mybatis工具类</p>
<pre><code class="java">//sqlSessionFactory --&gt; sqlSession
public class MybatisUtils &#123;

    private static SqlSessionFactory sqlSessionFactory;

    static&#123;
        try &#123;
            //使用Mybatis第一步：获取sqlSessionFactory对象
            String resource = &quot;mybatis-config.xml&quot;;
            InputStream inputStream = Resources.getResourceAsStream(resource);
            sqlSessionFactory = new SqlSessionFactoryBuilder().build(inputStream);
        &#125; catch (IOException e) &#123;
            e.printStackTrace();
        &#125;

    &#125;

    //既然有了 SqlSessionFactory，顾名思义，我们就可以从中获得 SqlSession 的实例了。
    // SqlSession 完全包含了面向数据库执行 SQL 命令所需的所有方法。
    public static SqlSession  getSqlSession()&#123;
        return sqlSessionFactory.openSession();
    &#125;

&#125;

</code></pre>
</li>
</ul>
<h3 id="2-3、编写代码"><a href="#2-3、编写代码" class="headerlink" title="2.3、编写代码"></a>2.3、编写代码</h3><ul>
<li><p>实体类</p>
<pre><code class="java">package com.kuang.pojo;

//实体类
public class User &#123;
    private int id;
    private String name;
    private String pwd;

    public User() &#123;
    &#125;

    public User(int id, String name, String pwd) &#123;
        this.id = id;
        this.name = name;
        this.pwd = pwd;
    &#125;

    public int getId() &#123;
        return id;
    &#125;

    public void setId(int id) &#123;
        this.id = id;
    &#125;

    public String getName() &#123;
        return name;
    &#125;

    public void setName(String name) &#123;
        this.name = name;
    &#125;

    public String getPwd() &#123;
        return pwd;
    &#125;

    public void setPwd(String pwd) &#123;
        this.pwd = pwd;
    &#125;

    @Override
    public String toString() &#123;
        return &quot;User&#123;&quot; +
                &quot;id=&quot; + id +
                &quot;, name=&#39;&quot; + name + &#39;\&#39;&#39; +
                &quot;, pwd=&#39;&quot; + pwd + &#39;\&#39;&#39; +
                &#39;&#125;&#39;;
    &#125;
&#125;

折叠 
</code></pre>
</li>
<li><p>Dao接口</p>
<pre><code class="java">public interface UserDao &#123;
    List&lt;User&gt; getUserList();
&#125;
</code></pre>
</li>
<li><p>接口实现类由原来的UserDaoImpl转变为一个 Mapper配置文件.</p>
<pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;
        &lt;!DOCTYPE mapper
                PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;
                &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;
        &lt;!--namespace=绑定一个对应的Dao/Mapper接口--&gt;
&lt;mapper namespace=&quot;com.kuang.dao.UserDao&quot;&gt;

&lt;!--select查询语句--&gt;
   &lt;select id=&quot;getUserList&quot; resultType=&quot;com.kuang.pojo.User&quot;&gt;
       select * from mybatis.user
   &lt;/select&gt;

&lt;/mapper&gt;
</code></pre>
</li>
</ul>
<h3 id="2-4、测试"><a href="#2-4、测试" class="headerlink" title="2.4、测试"></a>2.4、测试</h3><p>注意点：</p>
<p>org.apache.ibatis.binding.BindingException: Type interface com.kuang.dao.UserDao is not known to the MapperRegistry.</p>
<p><strong>MapperRegistry是什么？</strong></p>
<p>核心配置文件中注册 mappers</p>
<ul>
<li><p>junit测试</p>
<pre><code class="java">@Test
public void test()&#123;
    //第一步：获得SqlSession对象
    SqlSession sqlSession = MybatisUtils.getSqlSession();


    //方式一：getMapper
    UserDao userDao = sqlSession.getMapper(UserDao.class);
    List&lt;User&gt; userList = userDao.getUserList();

    for (User user : userList) &#123;
        System.out.println(user);
    &#125;



    //关闭SqlSession
    sqlSession.close();
&#125;
</code></pre>
</li>
</ul>
<p>你们可以能会遇到的问题：</p>
<ol>
<li>配置文件没有注册</li>
<li>绑定接口错误。</li>
<li>方法名不对</li>
<li>返回类型不对</li>
<li>Maven导出资源问题</li>
</ol>
<h2 id="3、CRUD"><a href="#3、CRUD" class="headerlink" title="3、CRUD"></a>3、CRUD</h2><h3 id="1、namespace"><a href="#1、namespace" class="headerlink" title="1、namespace"></a>1、namespace</h3><p>namespace中的包名要和 Dao&#x2F;mapper 接口的包名一致！</p>
<h3 id="2、select"><a href="#2、select" class="headerlink" title="2、select"></a>2、select</h3><p>选择，查询语句;</p>
<ul>
<li>id : 就是对应的namespace中的方法名；</li>
<li>resultType：Sql语句执行的返回值！</li>
<li>parameterType ： 参数类型！</li>
</ul>
<ol>
<li><p>编写接口</p>
<pre><code class="java">//根据ID查询用户
User getUserById(int id);
</code></pre>
</li>
<li><p>编写对应的mapper中的sql语句</p>
<pre><code class="java">&lt;select id=&quot;getUserById&quot; parameterType=&quot;int&quot; resultType=&quot;com.kuang.pojo.User&quot;&gt;
        select * from mybatis.user where id = #&#123;id&#125;
&lt;/select&gt;
</code></pre>
</li>
<li><p>测试</p>
<pre><code class="java">    @Test
    public void getUserById() &#123;
        SqlSession sqlSession = MybatisUtils.getSqlSession();

        UserMapper mapper = sqlSession.getMapper(UserMapper.class);

        User user = mapper.getUserById(1);
        System.out.println(user);

        sqlSession.close();
    &#125;
</code></pre>
</li>
</ol>
<h3 id="3、Insert"><a href="#3、Insert" class="headerlink" title="3、Insert"></a>3、Insert</h3><pre><code class="xml">    &lt;!--对象中的属性，可以直接取出来--&gt;
    &lt;insert id=&quot;addUser&quot; parameterType=&quot;com.kuang.pojo.User&quot;&gt;
        insert into mybatis.user (id, name, pwd) values (#&#123;id&#125;,#&#123;name&#125;,#&#123;pwd&#125;);
    &lt;/insert&gt;
</code></pre>
<h3 id="4、update"><a href="#4、update" class="headerlink" title="4、update"></a>4、update</h3><pre><code class="xml">    &lt;update id=&quot;updateUser&quot; parameterType=&quot;com.kuang.pojo.User&quot;&gt;
        update mybatis.user set name=#&#123;name&#125;,pwd=#&#123;pwd&#125;  where id = #&#123;id&#125; ;
    &lt;/update&gt;
</code></pre>
<h3 id="5、Delete"><a href="#5、Delete" class="headerlink" title="5、Delete"></a>5、Delete</h3><pre><code class="xml">    &lt;delete id=&quot;deleteUser&quot; parameterType=&quot;int&quot;&gt;
        delete from mybatis.user where id = #&#123;id&#125;;
    &lt;/delete&gt;
</code></pre>
<p>注意点：</p>
<ul>
<li>增删改需要提交事务！</li>
</ul>
<h3 id="6、分析错误"><a href="#6、分析错误" class="headerlink" title="6、分析错误"></a>6、分析错误</h3><ul>
<li>标签不要匹配错</li>
<li>resource 绑定mapper，需要使用路径！</li>
<li>程序配置文件必须符合规范！</li>
<li>NullPointerException，没有注册到资源!</li>
<li>输出的xml文件中存在中文乱码问题！</li>
<li>maven资源没有导出问题！</li>
</ul>
<h3 id="7、万能Map"><a href="#7、万能Map" class="headerlink" title="7、万能Map"></a>7、万能Map</h3><p>假设，我们的实体类，或者数据库中的表，字段或者参数过多，我们应当考虑使用Map！</p>
<pre><code class="java">    //万能的Map
    int addUser2(Map&lt;String,Object&gt; map);
    &lt;!--对象中的属性，可以直接取出来    传递map的key--&gt;
    &lt;insert id=&quot;addUser&quot; parameterType=&quot;map&quot;&gt;
        insert into mybatis.user (id, pwd) values (#&#123;userid&#125;,#&#123;passWord&#125;);
    &lt;/insert&gt;
    @Test
    public void addUser2()&#123;
        SqlSession sqlSession = MybatisUtils.getSqlSession();

        UserMapper mapper = sqlSession.getMapper(UserMapper.class);


        Map&lt;String, Object&gt; map = new HashMap&lt;String, Object&gt;();

        map.put(&quot;userid&quot;,5);
        map.put(&quot;passWord&quot;,&quot;2222333&quot;);

        mapper.addUser2(map);

        sqlSession.close();
    &#125;
</code></pre>
<p>Map传递参数，直接在sql中取出key即可！ 【parameterType&#x3D;”map”】</p>
<p>对象传递参数，直接在sql中取对象的属性即可！【parameterType&#x3D;”Object”】</p>
<p>只有一个基本类型参数的情况下，可以直接在sql中取到！</p>
<p>多个参数用Map，<strong>或者注解！</strong></p>
<h3 id="8、思考题"><a href="#8、思考题" class="headerlink" title="8、思考题"></a>8、思考题</h3><p>模糊查询怎么写？</p>
<ol>
<li><p>Java代码执行的时候，传递通配符 % %</p>
<pre><code class="java">List&lt;User&gt; userList = mapper.getUserLike(&quot;%李%&quot;);
</code></pre>
</li>
<li><p>在sql拼接中使用通配符！</p>
<pre><code class="java">select * from mybatis.user where name like &quot;%&quot;#&#123;value&#125;&quot;%&quot;
</code></pre>
</li>
</ol>
<h2 id="4、配置解析"><a href="#4、配置解析" class="headerlink" title="4、配置解析"></a>4、配置解析</h2><h3 id="1、核心配置文件"><a href="#1、核心配置文件" class="headerlink" title="1、核心配置文件"></a>1、核心配置文件</h3><ul>
<li><p>mybatis-config.xml</p>
</li>
<li><p>MyBatis 的配置文件包含了会深深影响 MyBatis 行为的设置和属性信息。</p>
<pre><code class="xml">configuration（配置）
properties（属性）
settings（设置）
typeAliases（类型别名）
typeHandlers（类型处理器）
objectFactory（对象工厂）
plugins（插件）
environments（环境配置）
environment（环境变量）
transactionManager（事务管理器）
dataSource（数据源）
databaseIdProvider（数据库厂商标识）
mappers（映射器）
</code></pre>
</li>
</ul>
<h3 id="2、环境配置（environments）"><a href="#2、环境配置（environments）" class="headerlink" title="2、环境配置（environments）"></a>2、环境配置（environments）</h3><p>MyBatis 可以配置成适应多种环境</p>
<p><strong>不过要记住：尽管可以配置多个环境，但每个 SqlSessionFactory 实例只能选择一种环境。</strong></p>
<p>学会使用配置多套运行环境！</p>
<p>Mybatis默认的事务管理器就是 JDBC ， 连接池 ： POOLED</p>
<h3 id="3、属性（properties）"><a href="#3、属性（properties）" class="headerlink" title="3、属性（properties）"></a>3、属性（properties）</h3><p>我们可以通过properties属性来实现引用配置文件</p>
<p>这些属性都是可外部配置且可动态替换的，既可以在典型的 Java 属性文件中配置，亦可通过 properties 元素的子元素来传递。	    【db.properties】</p>
<p><img src="https://cdn.jsdelivr.net/gh/ISDAY/FigureBed/2084540-20200916132425014-1129829737.png" alt="1569656528134"></p>
<p>编写一个配置文件</p>
<p>db.properties</p>
<pre><code class="properties">driver=com.mysql.jdbc.Driver
url=jdbc:mysql://localhost:3306/mybatis?useSSL=true&amp;useUnicode=true&amp;characterEncoding=UTF-8
username=root
password=mysql0917
</code></pre>
<p>在核心配置文件中映入</p>
<pre><code class="xml">    &lt;!--引入外部配置文件--&gt;
    &lt;properties resource=&quot;db.properties&quot;&gt;
        &lt;property name=&quot;username&quot; value=&quot;root&quot;/&gt;
        &lt;property name=&quot;pwd&quot; value=&quot;11111&quot;/&gt;
    &lt;/properties&gt;
</code></pre>
<ul>
<li>可以直接引入外部文件</li>
<li>可以在其中增加一些属性配置</li>
<li>如果两个文件有同一个字段，优先使用外部配置文件的！</li>
</ul>
<h3 id="4、类型别名（typeAliases）"><a href="#4、类型别名（typeAliases）" class="headerlink" title="4、类型别名（typeAliases）"></a>4、类型别名（typeAliases）</h3><ul>
<li>类型别名是为 Java 类型设置一个短的名字。‘</li>
<li>存在的意义仅在于用来减少类完全限定名的冗余。</li>
</ul>
<pre><code class="xml">    &lt;!--可以给实体类起别名--&gt;
    &lt;typeAliases&gt;
        &lt;typeAlias type=&quot;com.kuang.pojo.User&quot; alias=&quot;User&quot;/&gt;
    &lt;/typeAliases&gt;
</code></pre>
<p>也可以指定一个包名，MyBatis 会在包名下面搜索需要的 Java Bean，比如：</p>
<p>扫描实体类的包，它的默认别名就为这个类的 类名，首字母小写！</p>
<pre><code class="xml">&lt;!--可以给实体类起别名--&gt;
&lt;typeAliases&gt;
    &lt;package name=&quot;com.kuang.pojo&quot;/&gt;
&lt;/typeAliases&gt;
</code></pre>
<p>在实体类比较少的时候，使用第一种方式。</p>
<p>如果实体类十分多，建议使用第二种。</p>
<p>第一种可以DIY别名，第二种则·不行·，如果非要改，需要在实体上增加注解</p>
<pre><code class="java">@Alias(&quot;user&quot;)
public class User &#123;&#125;
</code></pre>
<h3 id="5、设置"><a href="#5、设置" class="headerlink" title="5、设置"></a>5、设置</h3><p>这是 MyBatis 中极为重要的调整设置，它们会改变 MyBatis 的运行时行为。</p>
<p><img src="https://cdn.jsdelivr.net/gh/ISDAY/FigureBed/2084540-20200916132425295-455086798.png" alt="1569657659080"></p>
<p><img src="/assets/mybatiskuangsheng/2084540-20200916132425509-1329526048.png" alt="1569657672791"></p>
<h3 id="6、其他配置"><a href="#6、其他配置" class="headerlink" title="6、其他配置"></a>6、其他配置</h3><ul>
<li><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/zh/configuration.html#typeHandlers">typeHandlers（类型处理器）</a></li>
<li><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/zh/configuration.html#objectFactory">objectFactory（对象工厂）</a></li>
<li>plugins插件<ul>
<li>mybatis-generator-core</li>
<li>mybatis-plus</li>
<li>通用mapper</li>
</ul>
</li>
</ul>
<h3 id="7、映射器（mappers）"><a href="#7、映射器（mappers）" class="headerlink" title="7、映射器（mappers）"></a>7、映射器（mappers）</h3><p>MapperRegistry：注册绑定我们的Mapper文件；</p>
<p>方式一： 【推荐使用】</p>
<pre><code class="xml">&lt;!--每一个Mapper.XML都需要在Mybatis核心配置文件中注册！--&gt;
&lt;mappers&gt;
    &lt;mapper resource=&quot;com/kuang/dao/UserMapper.xml&quot;/&gt;
&lt;/mappers&gt;
</code></pre>
<p>方式二：使用class文件绑定注册</p>
<pre><code class="xml">&lt;!--每一个Mapper.XML都需要在Mybatis核心配置文件中注册！--&gt;
&lt;mappers&gt;
    &lt;mapper class=&quot;com.kuang.dao.UserMapper&quot;/&gt;
&lt;/mappers&gt;
</code></pre>
<p>注意点：</p>
<ul>
<li>接口和他的Mapper配置文件必须同名！</li>
<li>接口和他的Mapper配置文件必须在同一个包下！</li>
</ul>
<p>方式三：使用扫描包进行注入绑定</p>
<pre><code class="xml">&lt;!--每一个Mapper.XML都需要在Mybatis核心配置文件中注册！--&gt;
&lt;mappers&gt;
    &lt;package name=&quot;com.kuang.dao&quot;/&gt;
&lt;/mappers&gt;
</code></pre>
<p>注意点：</p>
<ul>
<li>接口和他的Mapper配置文件必须同名！</li>
<li>接口和他的Mapper配置文件必须在同一个包下！</li>
</ul>
<p>练习时间：</p>
<ul>
<li>将数据库配置文件外部引入</li>
<li>实体类别名</li>
<li>保证UserMapper 接口 和 UserMapper .xml 改为一致！并且放在同一个包下！</li>
</ul>
<h3 id="8、生命周期和作用域"><a href="#8、生命周期和作用域" class="headerlink" title="8、生命周期和作用域"></a>8、生命周期和作用域</h3><p><img src="https://cdn.jsdelivr.net/gh/ISDAY/FigureBed/2084540-20200916132425710-1579637144.png" alt="1569660357745"></p>
<p>生命周期，和作用域，是至关重要的，因为错误的使用会导致非常严重的<strong>并发问题</strong>。</p>
<p><strong>SqlSessionFactoryBuilder：</strong></p>
<ul>
<li>一旦创建了 SqlSessionFactory，就不再需要它了</li>
<li>局部变量</li>
</ul>
<p><strong>SqlSessionFactory：</strong></p>
<ul>
<li>说白了就是可以想象为 ：数据库连接池</li>
<li>SqlSessionFactory 一旦被创建就应该在应用的运行期间一直存在，<strong>没有任何理由丢弃它或重新创建另一个实例。</strong></li>
<li>因此 SqlSessionFactory 的最佳作用域是应用作用域。</li>
<li>最简单的就是使用<strong>单例模式</strong>或者静态单例模式。</li>
</ul>
<p><strong>SqlSession</strong></p>
<ul>
<li>连接到连接池的一个请求！</li>
<li>SqlSession 的实例不是线程安全的，因此是不能被共享的，所以它的最佳的作用域是请求或方法作用域。</li>
<li>用完之后需要赶紧关闭，否则资源被占用！</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/ISDAY/FigureBed/2084540-20200916132425892-1365646093.png" alt="1569660737088"></p>
<p>这里面的每一个Mapper，就代表一个具体的业务！</p>
<h2 id="5、解决属性名和字段名不一致的问题"><a href="#5、解决属性名和字段名不一致的问题" class="headerlink" title="5、解决属性名和字段名不一致的问题"></a>5、解决属性名和字段名不一致的问题</h2><h3 id="1、-问题"><a href="#1、-问题" class="headerlink" title="1、 问题"></a>1、 问题</h3><p>数据库中的字段</p>
<p><img src="https://cdn.jsdelivr.net/gh/ISDAY/FigureBed/2084540-20200916132426065-922439632.png" alt="1569660831076"></p>
<p>新建一个项目，拷贝之前的，测试实体类字段不一致的情况</p>
<pre><code class="java">public class User &#123;
    
    private int id;
    private String name;
    private String password;
&#125;
</code></pre>
<p>测试出现问题</p>
<p><img src="https://cdn.jsdelivr.net/gh/ISDAY/FigureBed/2084540-20200916132426229-957403968.png" alt="1569661145806"></p>
<pre><code class="xml">//    select * from mybatis.user where id = #&#123;id&#125;
//类型处理器
//    select id,name,pwd from mybatis.user where id = #&#123;id&#125;
</code></pre>
<p>解决方法：</p>
<ul>
<li><p>起别名</p>
<pre><code class="xml">&lt;select id=&quot;getUserById&quot; resultType=&quot;com.kuang.pojo.User&quot;&gt;
    select id,name,pwd as password from mybatis.user where id = #&#123;id&#125;
&lt;/select&gt;
</code></pre>
</li>
</ul>
<h3 id="2、resultMap"><a href="#2、resultMap" class="headerlink" title="2、resultMap"></a>2、resultMap</h3><p>结果集映射</p>
<pre><code class="bash">id   name   pwd
id   name   password
&lt;!--结果集映射--&gt;
&lt;resultMap id=&quot;UserMap&quot; type=&quot;User&quot;&gt;
    &lt;!--column数据库中的字段，property实体类中的属性--&gt;
    &lt;result column=&quot;id&quot; property=&quot;id&quot;/&gt;
    &lt;result column=&quot;name&quot; property=&quot;name&quot;/&gt;
    &lt;result column=&quot;pwd&quot; property=&quot;password&quot;/&gt;
&lt;/resultMap&gt;

&lt;select id=&quot;getUserById&quot; resultMap=&quot;UserMap&quot;&gt;
    select * from mybatis.user where id = #&#123;id&#125;
&lt;/select&gt;
</code></pre>
<ul>
<li><code>resultMap</code> 元素是 MyBatis 中最重要最强大的元素</li>
<li>ResultMap 的设计思想是，对于简单的语句根本不需要配置显式的结果映射，而对于复杂一点的语句只需要描述它们的关系就行了。</li>
<li><code>ResultMap</code> 最优秀的地方在于，虽然你已经对它相当了解了，但是根本就不需要显式地用到他们。</li>
<li>如果世界总是这么简单就好了。</li>
</ul>
<h2 id="6、日志"><a href="#6、日志" class="headerlink" title="6、日志"></a>6、日志</h2><h3 id="6-1、日志工厂"><a href="#6-1、日志工厂" class="headerlink" title="6.1、日志工厂"></a>6.1、日志工厂</h3><p>如果一个数据库操作，出现了异常，我们需要排错。日志就是最好的助手！</p>
<p>曾经：sout 、debug</p>
<p>现在：日志工厂！</p>
<p><img src="https://cdn.jsdelivr.net/gh/ISDAY/FigureBed/2084540-20200916132426391-662536759.png" alt="1569892155104"></p>
<ul>
<li>SLF4J</li>
<li>LOG4J 【掌握】</li>
<li>LOG4J2</li>
<li>JDK_LOGGING</li>
<li>COMMONS_LOGGING</li>
<li>STDOUT_LOGGING 【掌握】</li>
<li>NO_LOGGING</li>
</ul>
<p>在Mybatis中具体使用那个一日志实现，在设置中设定！</p>
<p><strong>STDOUT_LOGGING标准日志输出</strong></p>
<p>在mybatis核心配置文件中，配置我们的日志！</p>
<pre><code class="xml">&lt;settings&gt;
    &lt;setting name=&quot;logImpl&quot; value=&quot;STDOUT_LOGGING&quot;/&gt;
&lt;/settings&gt;
</code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/ISDAY/FigureBed/2084540-20200916132426595-1023620136.png" alt="1569892595060"></p>
<h3 id="6-2、Log4j"><a href="#6-2、Log4j" class="headerlink" title="6.2、Log4j"></a>6.2、Log4j</h3><p>什么是Log4j？</p>
<ul>
<li>Log4j是<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/Apache/8512995">Apache</a>的一个开源项目，通过使用Log4j，我们可以控制日志信息输送的目的地是<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E6%8E%A7%E5%88%B6%E5%8F%B0/2438626">控制台</a>、文件、<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/GUI">GUI</a>组件</li>
<li>我们也可以控制每一条日志的输出格式；</li>
<li>通过定义每一条日志信息的级别，我们能够更加细致地控制日志的生成过程。</li>
<li>通过一个<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/286550">配置文件</a>来灵活地进行配置，而不需要修改应用的代码。</li>
</ul>
<ol>
<li><p>先导入log4j的包</p>
<pre><code class="xml">&lt;!-- https://mvnrepository.com/artifact/log4j/log4j --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;log4j&lt;/groupId&gt;
    &lt;artifactId&gt;log4j&lt;/artifactId&gt;
    &lt;version&gt;1.2.17&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
</li>
<li><p>log4j.properties</p>
<pre><code class="properties">#将等级为DEBUG的日志信息输出到console和file这两个目的地，console和file的定义在下面的代码
log4j.rootLogger=DEBUG,console,file

#控制台输出的相关设置
log4j.appender.console = org.apache.log4j.ConsoleAppender
log4j.appender.console.Target = System.out
log4j.appender.console.Threshold=DEBUG
log4j.appender.console.layout = org.apache.log4j.PatternLayout
log4j.appender.console.layout.ConversionPattern=[%c]-%m%n

#文件输出的相关设置
log4j.appender.file = org.apache.log4j.RollingFileAppender
log4j.appender.file.File=./log/kuang.log
log4j.appender.file.MaxFileSize=10mb
log4j.appender.file.Threshold=DEBUG
log4j.appender.file.layout=org.apache.log4j.PatternLayout
log4j.appender.file.layout.ConversionPattern=[%p][%d&#123;yy-MM-dd&#125;][%c]%m%n

#日志输出级别
log4j.logger.org.mybatis=DEBUG
log4j.logger.java.sql=DEBUG
log4j.logger.java.sql.Statement=DEBUG
log4j.logger.java.sql.ResultSet=DEBUG
log4j.logger.java.sql.PreparedStatement=DEBUG
</code></pre>
</li>
<li><p>配置log4j为日志的实现</p>
<pre><code class="xml">&lt;settings&gt;
    &lt;setting name=&quot;logImpl&quot; value=&quot;&quot;/&gt;
&lt;/settings&gt;
</code></pre>
</li>
<li><p>Log4j的使用！，直接测试运行刚才的查询</p>
<p><img src="https://cdn.jsdelivr.net/gh/ISDAY/FigureBed/2084540-20200916132426821-1121850478.png" alt="1569893505842"></p>
</li>
</ol>
<p><strong>简单使用</strong></p>
<ol>
<li><p>在要使用Log4j 的类中，导入包 import org.apache.log4j.Logger;</p>
</li>
<li><p>日志对象，参数为当前类的class</p>
<pre><code class="java">static Logger logger = Logger.getLogger(UserDaoTest.class);
</code></pre>
</li>
<li><p>日志级别</p>
<pre><code class="java">logger.info(&quot;info:进入了testLog4j&quot;);
logger.debug(&quot;debug:进入了testLog4j&quot;);
logger.error(&quot;error:进入了testLog4j&quot;);
</code></pre>
</li>
</ol>
<h2 id="7、分页"><a href="#7、分页" class="headerlink" title="7、分页"></a>7、分页</h2><p><strong>思考：为什么要分页？</strong></p>
<ul>
<li>减少数据的处理量</li>
</ul>
<h3 id="7-1、使用Limit分页"><a href="#7-1、使用Limit分页" class="headerlink" title="7.1、使用Limit分页"></a>7.1、使用Limit分页</h3><pre><code class="sql">语法：SELECT * from user limit startIndex,pageSize;
SELECT * from user limit 3;  #[0,n]
</code></pre>
<p>使用Mybatis实现分页，核心SQL</p>
<ol>
<li><p>接口</p>
<pre><code class="java">//分页
List&lt;User&gt; getUserByLimit(Map&lt;String,Integer&gt; map);
</code></pre>
</li>
<li><p>Mapper.xml</p>
<pre><code class="xml">&lt;!--//分页--&gt;
&lt;select id=&quot;getUserByLimit&quot; parameterType=&quot;map&quot; resultMap=&quot;UserMap&quot;&gt;
    select * from  mybatis.user limit #&#123;startIndex&#125;,#&#123;pageSize&#125;
&lt;/select&gt;
</code></pre>
</li>
<li><p>测试</p>
<pre><code class="java">@Test
public void getUserByLimit()&#123;
SqlSession sqlSession = MybatisUtils.getSqlSession();
UserMapper mapper = sqlSession.getMapper(UserMapper.class);

HashMap&lt;String, Integer&gt; map = new HashMap&lt;String, Integer&gt;();
    map.put(&quot;startIndex&quot;,1);
    map.put(&quot;pageSize&quot;,2);

    List&lt;User&gt; userList =  mapper.getUserByLimit(map);
    for (User user : userList) &#123;
    System.out.println(user);
    &#125;

    sqlSession.close();
    &#125;
</code></pre>
</li>
</ol>
<h3 id="7-2、RowBounds分页"><a href="#7-2、RowBounds分页" class="headerlink" title="7.2、RowBounds分页"></a>7.2、RowBounds分页</h3><p>不再使用SQL实现分页</p>
<ol>
<li><p>接口</p>
<pre><code class="java">//分页2
List&lt;User&gt; getUserByRowBounds();
</code></pre>
</li>
<li><p>mapper.xml</p>
<pre><code class="xml">&lt;!--分页2--&gt;
&lt;select id=&quot;getUserByRowBounds&quot; resultMap=&quot;UserMap&quot;&gt;
    select * from  mybatis.user
&lt;/select&gt;
</code></pre>
</li>
<li><p>测试</p>
<pre><code class="java">@Test
public void getUserByRowBounds()&#123;
SqlSession sqlSession = MybatisUtils.getSqlSession();

//RowBounds实现
RowBounds rowBounds = new RowBounds(1, 2);

//通过Java代码层面实现分页
List&lt;User&gt; userList = sqlSession.selectList(&quot;com.kuang.dao.UserMapper.getUserByRowBounds&quot;,null,rowBounds);

    for (User user : userList) &#123;
    System.out.println(user);
    &#125;

    sqlSession.close();
    &#125;
</code></pre>
</li>
</ol>
<h3 id="7-3、分页插件"><a href="#7-3、分页插件" class="headerlink" title="7.3、分页插件"></a>7.3、分页插件</h3><p><img src="https://cdn.jsdelivr.net/gh/ISDAY/FigureBed/2084540-20200916132427106-481754588.png" alt="1569896603103"></p>
<p>了解即可，万一 以后公司的架构师，说要使用，你需要知道它是什么东西！</p>
<h2 id="8、使用注解开发"><a href="#8、使用注解开发" class="headerlink" title="8、使用注解开发"></a>8、使用注解开发</h2><h3 id="8-1、面向接口编程"><a href="#8-1、面向接口编程" class="headerlink" title="8.1、面向接口编程"></a>8.1、面向接口编程</h3><p>- 大家之前都学过面向对象编程，也学习过接口，但在真正的开发中，很多时候我们会选择面向接口编程<br>- <strong>根本原因 : &#x3D;&#x3D;解耦&#x3D;&#x3D;, 可拓展 , 提高复用 , 分层开发中 , 上层不用管具体的实现 , 大家都遵守共同的标准 , 使得开发变得容易 , 规范性更好</strong><br>- 在一个面向对象的系统中，系统的各种功能是由许许多多的不同对象协作完成的。在这种情况下，各个对象内部是如何实现自己的,对系统设计人员来讲就不那么重要了；<br>- 而各个对象之间的协作关系则成为系统设计的关键。小到不同类之间的通信，大到各模块之间的交互，在系统设计之初都是要着重考虑的，这也是系统设计的主要工作内容。面向接口编程就是指按照这种思想来编程。</p>
<p><strong>关于接口的理解</strong></p>
<p>- 接口从更深层次的理解，应是定义（规范，约束）与实现（名实分离的原则）的分离。<br>        - 接口的本身反映了系统设计人员对系统的抽象理解。<br>        - 接口应有两类：<br>        - 第一类是对一个个体的抽象，它可对应为一个抽象体(abstract class)；<br>        - 第二类是对一个个体某一方面的抽象，即形成一个抽象面（interface）；<br>        - 一个体有可能有多个抽象面。抽象体与抽象面是有区别的。</p>
<p><strong>三个面向区别</strong></p>
<p>- 面向对象是指，我们考虑问题时，以对象为单位，考虑它的属性及方法 .<br>- 面向过程是指，我们考虑问题时，以一个具体的流程（事务过程）为单位，考虑它的实现 .<br>- 接口设计与非接口设计是针对复用技术而言的，与面向对象（过程）不是一个问题.更多的体现就是对系统整体的架构</p>
<h3 id="8-2、使用注解开发"><a href="#8-2、使用注解开发" class="headerlink" title="8.2、使用注解开发"></a>8.2、使用注解开发</h3><ol>
<li><p>注解在接口上实现</p>
<pre><code class="java">@Select(&quot;select * from user&quot;)
List&lt;User&gt; getUsers();
</code></pre>
</li>
<li><p>需要再核心配置文件中绑定接口！</p>
<pre><code class="xml">&lt;!--绑定接口--&gt;
&lt;mappers&gt;
    &lt;mapper class=&quot;com.kuang.dao.UserMapper&quot;/&gt;
&lt;/mappers&gt;
</code></pre>
</li>
<li><p>测试</p>
</li>
</ol>
<p>本质：反射机制实现</p>
<p>底层：动态代理！</p>
<p><img src="https://cdn.jsdelivr.net/gh/ISDAY/FigureBed/2084540-20200916132427311-1737862394.png" alt="1569898830704"></p>
<p><strong>Mybatis详细的执行流程！</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/ISDAY/FigureBed/2084540-20200916132427508-886466614.png" alt="1569898830704"></p>
<h3 id="8-3、CRUD"><a href="#8-3、CRUD" class="headerlink" title="8.3、CRUD"></a>8.3、CRUD</h3><p>我们可以在工具类创建的时候实现自动提交事务！</p>
<pre><code class="java">public static SqlSession  getSqlSession()&#123;
    return sqlSessionFactory.openSession(true);
&#125;
</code></pre>
<p>编写接口，增加注解</p>
<pre><code class="java">public interface UserMapper &#123;

    @Select(&quot;select * from user&quot;)
    List&lt;User&gt; getUsers();

    // 方法存在多个参数，所有的参数前面必须加上 @Param(&quot;id&quot;)注解
    @Select(&quot;select * from user where id = #&#123;id&#125;&quot;)
    User getUserByID(@Param(&quot;id&quot;) int id);


    @Insert(&quot;insert into user(id,name,pwd) values (#&#123;id&#125;,#&#123;name&#125;,#&#123;password&#125;)&quot;)
    int addUser(User user);

    
    @Update(&quot;update user set name=#&#123;name&#125;,pwd=#&#123;password&#125; where id = #&#123;id&#125;&quot;)
    int updateUser(User user);

    
    @Delete(&quot;delete from user where id = #&#123;uid&#125;&quot;)
    int deleteUser(@Param(&quot;uid&quot;) int id);
&#125;
</code></pre>
<p>测试类</p>
<p>【注意：我们必须要讲接口注册绑定到我们的核心配置文件中！】</p>
<p><strong>关于@Param() 注解</strong></p>
<ul>
<li>基本类型的参数或者String类型，需要加上</li>
<li>引用类型不需要加</li>
<li>如果只有一个基本类型的话，可以忽略，但是建议大家都加上！</li>
<li>我们在SQL中引用的就是我们这里的 @Param() 中设定的属性名！</li>
</ul>
<p><strong>#{} ${} 区别</strong></p>
<h2 id="9、Lombok"><a href="#9、Lombok" class="headerlink" title="9、Lombok"></a>9、Lombok</h2><pre><code class="java">Project Lombok is a java library that automatically plugs into your editor and build tools, spicing up your java.
Never write another getter or equals method again, with one annotation your class has a fully featured builder, Automate your logging variables, and much more.
</code></pre>
<ul>
<li>java library</li>
<li>plugs</li>
<li>build tools</li>
<li>with one annotation your class</li>
</ul>
<p>使用步骤：</p>
<ol>
<li><p>在IDEA中安装Lombok插件！</p>
</li>
<li><p>在项目中导入lombok的jar包</p>
<pre><code class="xml">&lt;dependency&gt;
    &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
    &lt;artifactId&gt;lombok&lt;/artifactId&gt;
    &lt;version&gt;1.18.10&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
</li>
<li><p>在实体类上加注解即可！</p>
<pre><code class="java">@Data
@AllArgsConstructor
@NoArgsConstructor
</code></pre>
</li>
</ol>
<pre><code class="java">@Getter and @Setter
@FieldNameConstants
@ToString
@EqualsAndHashCode
@AllArgsConstructor, @RequiredArgsConstructor and @NoArgsConstructor
@Log, @Log4j, @Log4j2, @Slf4j, @XSlf4j, @CommonsLog, @JBossLog, @Flogger
@Data
@Builder
@Singular
@Delegate
@Value
@Accessors
@Wither
@SneakyThrows
</code></pre>
<p>说明：</p>
<pre><code class="less">@Data：无参构造，get、set、tostring、hashcode，equals
@AllArgsConstructor
@NoArgsConstructor
@EqualsAndHashCode
@ToString
@Getter
</code></pre>
<h2 id="10、多对一处理"><a href="#10、多对一处理" class="headerlink" title="10、多对一处理"></a>10、多对一处理</h2><p>​	多对一：</p>
<p><img src="https://cdn.jsdelivr.net/gh/ISDAY/FigureBed/image-20220710114210927.png" alt="image-20220710114210927"></p>
<ul>
<li>多个学生，对应一个老师</li>
<li>对于学生而言， <strong>关联</strong>..  多个学生，关联一个老师 【多对一】</li>
<li>对于老师而言，<strong>集合</strong>，一个老师，有很多学生 【一对多】</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/ISDAY/FigureBed/image-20220710121217911.png" alt="image-20220710121217911"></p>
<p>SQL：</p>
<pre><code class="sql">CREATE TABLE (
    `id` INT(10)	NOT NULL,
    `name` VARCHAR(30) DEFAULT NULL,
    PRIMARY KEY(`id`)
)ENGINE= INNODB DEFAULT CHARSET=utf8

INSERT INTO teacher(`id`,`name`) VALUES (1,&#39;秦老师&#39;);

CREATE TABLE `student`(
    `id` INT(10)	NOT NULL,
    `name` VARCHAR(30) DEFAULT NULL,
    `tid` INT(10) DEFAULT NULL,
    PRIMARY KEY(`id`),
    KEY `fktid` (`tid`),
    CONSTRAINT `fktid` FOREIGN KEY (`tid`) REFERENCES `teacher` (`id`)
)ENGINE= INNODB DEFAULT CHARSET=utf8

INSERT INTO student(`id`,`name`,`tid`) VALUES (1,&#39;小明&#39;,&#39;1&#39;);
INSERT INTO student(`id`,`name`,`tid`) VALUES (2,&#39;小红&#39;,&#39;1&#39;);
INSERT INTO student(`id`,`name`,`tid`) VALUES (3,&#39;小张&#39;,&#39;1&#39;);
INSERT INTO student(`id`,`name`,`tid`) VALUES (4,&#39;小李&#39;,&#39;1&#39;);
INSERT INTO student(`id`,`name`,`tid`) VALUES (5,&#39;小王&#39;,&#39;1&#39;);
</code></pre>
<h3 id="测试环境搭建"><a href="#测试环境搭建" class="headerlink" title="测试环境搭建"></a>测试环境搭建</h3><ol>
<li>导入lombok</li>
<li>新建实体类Teacher,Student</li>
<li>建立Mapper接口</li>
<li>建立Mapper.xml文件</li>
<li>在核心配置文件中绑定注册我们的Mapper接口或文件！</li>
<li>测试查询是否能够成功！</li>
</ol>
<h3 id="按照查询嵌套处理"><a href="#按照查询嵌套处理" class="headerlink" title="按照查询嵌套处理"></a>按照查询嵌套处理</h3><pre><code>    &lt;!--
      思路:
        1. 查询所有的学生信息
        2.根据查询出来的学生的tid，寻找对应的老师！  子查询
    --&gt;
    &lt;select id=&quot;getStudent&quot; resultMap=&quot;StudentTeanher&quot;&gt;
        select * from student
    &lt;/select&gt;

    &lt;resultMap id=&quot;StudentTeanher&quot; type=&quot;Student&quot;&gt;
        &lt;result property=&quot;id&quot; column=&quot;id&quot;/&gt;
        &lt;result property=&quot;name&quot; column=&quot;name&quot;/&gt;
        &lt;!--复杂的属性，我们需要单独处理 对象: association  集合: collection --&gt;
        &lt;association property=&quot;teacher&quot; column=&quot;tid&quot; javaType=&quot;Teacher&quot; select=&quot;getTeacher&quot;/&gt;
    &lt;/resultMap&gt;
    
    &lt;select id=&quot;getTeacher&quot; resultType=&quot;Teacher&quot;&gt;
        select * from teacher where id = #&#123;id&#125;
    &lt;/select&gt;
</code></pre>
<h3 id="按照结果嵌套处理"><a href="#按照结果嵌套处理" class="headerlink" title="按照结果嵌套处理"></a>按照结果嵌套处理</h3><pre><code class="xml">   &lt;!--按照结果嵌套处理--&gt;
    &lt;select id=&quot;getStudent2&quot; resultMap=&quot;StudentTeacher2&quot;&gt;
        select s.id sid,s.name sname,t.name tname
        from student s,teacher t
        where s.tid = t.id
    &lt;/select&gt;
    &lt;resultMap id=&quot;StudentTeacher2&quot; type=&quot;Student&quot;&gt;
        &lt;result property=&quot;id&quot; column=&quot;sid&quot;/&gt;
        &lt;result property=&quot;name&quot; column=&quot;sname&quot;/&gt;
        &lt;association property=&quot;teacher&quot; javaType=&quot;Teacher&quot;&gt;
            &lt;result property=&quot;name&quot; column=&quot;tname&quot;/&gt;
        &lt;/association&gt;
    &lt;/resultMap&gt;
</code></pre>
<p>回顾MySQL 多对一查询方式：</p>
<ul>
<li><p>子查询</p>
</li>
<li><p>联表查询</p>
</li>
</ul>
<h2 id="11、一对多处理"><a href="#11、一对多处理" class="headerlink" title="11、一对多处理"></a>11、一对多处理</h2><p>比如：一个老师拥有多个学生！</p>
<p>对于老师而言，就是一对多的关系！</p>
<h3 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h3><p><strong>实体类</strong></p>
<pre><code class="java">@Data
public class Teacher &#123;
    private int id;
    private String name;
    
    //一个老师拥有多个学生
    private List&lt;Student&gt; students;
&#125;
</code></pre>
<pre><code class="java">@Data
public class Student &#123;
    private int id;
    private String name;
    private int tid;

&#125;
</code></pre>
<h3 id="按照结果嵌套处理-1"><a href="#按照结果嵌套处理-1" class="headerlink" title="按照结果嵌套处理"></a><strong>按照结果嵌套处理</strong></h3><pre><code class="xml">    &lt;!--按照结果嵌套处理--&gt;
    &lt;select id=&quot;getAllTeacher&quot; resultMap=&quot;TeacherStudent&quot;&gt;
        select s.id sid,s.name sname,t.name tname,t.id tid
        from student s,teacher t
        where s.tid = t.id and t.id = #&#123;tid&#125;
    &lt;/select&gt;
    &lt;resultMap id=&quot;TeacherStudent&quot; type=&quot;Teacher&quot;&gt;
        &lt;result property=&quot;id&quot; column=&quot;tid&quot;/&gt;
        &lt;result property=&quot;name&quot; column=&quot;tname&quot;/&gt;
        &lt;!--复杂的属性，我们需要单独处理 对象: association  集合: collection
            javaType=&quot;&quot; 指定属性的类型！
            集合中的泛型信息，我们使用ofType获取
        --&gt;
        &lt;collection property=&quot;students&quot; ofType=&quot;Student&quot;&gt;
            &lt;result property=&quot;id&quot; column=&quot;sid&quot;/&gt;
            &lt;result property=&quot;name&quot; column=&quot;sname&quot;/&gt;
            &lt;result property=&quot;tid&quot; column=&quot;tid&quot;/&gt;
        &lt;/collection&gt;
    &lt;/resultMap&gt;
</code></pre>
<h3 id="按照查询嵌套处理-1"><a href="#按照查询嵌套处理-1" class="headerlink" title="按照查询嵌套处理"></a><strong>按照查询嵌套处理</strong></h3><pre><code class="xml">&lt;select id=&quot;getAllTeacher2&quot; resultMap=&quot;TeacherStudent2&quot;&gt;
    select * from teacher where id = #&#123;tid&#125;
&lt;/select&gt;
&lt;resultMap id=&quot;TeacherStudent2&quot; type=&quot;Teacher&quot;&gt;
    &lt;collection property=&quot;students&quot; column=&quot;id&quot; javaType=&quot;ArrayList&quot; ofType=&quot;Student&quot; select=&quot;getStudent&quot;/&gt;
&lt;/resultMap&gt;
&lt;select id=&quot;getStudent&quot; resultType=&quot;Student&quot;&gt;
    select * from student where tid = #&#123;tid&#125;
&lt;/select&gt;
</code></pre>
<h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><ol>
<li>关联 -association 【多对一】</li>
<li>集合 -collection  【一对多】</li>
<li>javaType  &amp;  ofType<ol>
<li>javaType   用来指定实体类中属性的类型</li>
<li>ofType       用来指定映射到List或者集合中的bean(pojo)类型，泛型中的约束类型！</li>
</ol>
</li>
</ol>
<p>注意点：</p>
<ul>
<li>保证SQL的可读性，尽量保证通俗易懂</li>
<li>注意一对多和多对一中属性名和字段的问题！</li>
<li>如果问题不好排查，可以使用日志，建议使用log4j</li>
</ul>
<p>面试高频</p>
<ul>
<li>MySQL引擎</li>
<li>InnoDB底层原理</li>
<li>索引</li>
<li>索引优化！</li>
</ul>
<h2 id="12、动态-SQL"><a href="#12、动态-SQL" class="headerlink" title="12、动态 SQL"></a>12、动态 SQL</h2><p>&#x3D;&#x3D;<strong>什么是动态SQL：动态SQL就是指根据不同条件生成的SQL语句</strong>&#x3D;&#x3D;</p>
<p>利用动态SQL这一特性可以彻底摆脱这种痛苦。</p>
<pre><code class="xml">动态 SQL元素和  JSTL 或任何基于类 XML 语言的文本处理器相似。在 MyBatis 之前的版本中，需要花时间了解大量的元素。借助功能强大的基于 OGNL 的表达式，MyBatis 3 替换了之前的大部分元素，大大精简了元素种类，现在要学习的元素种类比原来的一半还要少。

if
choose (when, otherwise)
trim (where, set)
foreach
</code></pre>
<h3 id="搭建环境"><a href="#搭建环境" class="headerlink" title="搭建环境"></a>搭建环境</h3><pre><code class="sql">CREATE TABLE `blog`(
    `id` VARCHAR(50) NOT NULL COMMENT &#39;博客id&#39;,
    `title` VARCHAR(100) NOT NULL COMMENT &#39;博客标题&#39;,
    `author` VARCHAR(30) NOT NULL COMMENT &#39;博客作者&#39;,
    `create_time` datetime NOT NULL COMMENT &#39;创建时间&#39;,
    `views` INT(30) NOT NULL COMMENT &#39;浏览量&#39;
    )ENGINE = INNODB DEFAULT charset=utf8
</code></pre>
<p>创建一个基础工程</p>
<ol>
<li><p>导包</p>
</li>
<li><p>编写配置文件</p>
</li>
<li><p>编写实体类</p>
<pre><code class="java">
@Data
public class Bloginfo &#123;
    private int id;
    private String title;
    private String author;
    private Date createTime;
    private int views;
&#125;
</code></pre>
</li>
<li><p>编写实体类对应Mapper接口 和 Mapper.XML文件</p>
<p>自动提交事务【工具类】</p>
<p><img src="https://cdn.jsdelivr.net/gh/ISDAY/FigureBed/image-20220710224107966.png" alt="image-20220710224107966"></p>
</li>
</ol>
<h3 id="IF"><a href="#IF" class="headerlink" title="IF"></a>IF</h3><pre><code class="xml">  &lt;select id=&quot;querBlogIF&quot; parameterType=&quot;map&quot; resultType=&quot;Bloginfo&quot;&gt;
        select * from blog where 1 = 1
        &lt;if test=&quot;title != null&quot;&gt;
            and title = #&#123;title&#125;
        &lt;/if&gt;
        &lt;if test=&quot;author != null&quot;&gt;
            and author = #&#123;author&#125;
        &lt;/if&gt;
    &lt;/select&gt;
</code></pre>
<h3 id="choose-when-otherwise"><a href="#choose-when-otherwise" class="headerlink" title="choose (when, otherwise)"></a>choose (when, otherwise)</h3><pre><code class="xml">&lt;select id=&quot;querBlogChoose&quot; parameterType=&quot;map&quot; resultType=&quot;Bloginfo&quot;&gt;
        select * from blog
        &lt;where&gt;
            &lt;choose&gt;
                &lt;when test=&quot;title != null&quot;&gt;
                    title = #&#123;title&#125;
                &lt;/when&gt;
                &lt;when test=&quot;author != null&quot;&gt;
                    and author = #&#123;author&#125;
                &lt;/when&gt;
                &lt;otherwise&gt;
                    and views = #&#123;views&#125;
                &lt;/otherwise&gt;
            &lt;/choose&gt;
        &lt;/where&gt;

    &lt;/select&gt;
</code></pre>
<h3 id="trim-where-set"><a href="#trim-where-set" class="headerlink" title="trim (where, set)"></a>trim (where, set)</h3><pre><code class="xml">&lt;select id=&quot;querBlogChoose&quot; parameterType=&quot;map&quot; resultType=&quot;Bloginfo&quot;&gt;
        select * from blog
        &lt;where&gt;
            &lt;if test=&quot;title != null&quot;&gt;
                title = #&#123;title&#125;
            &lt;/if&gt;
            &lt;if test=&quot;author != null&quot;&gt;
                and author = #&#123;author&#125;
            &lt;/if&gt;
        &lt;/where&gt;

    &lt;/select&gt;
</code></pre>
<pre><code class="xml">&lt;update id=&quot;updateAuthorIfNecessary&quot;&gt;
  update Author
    &lt;set&gt;
      &lt;if test=&quot;username != null&quot;&gt;username=#&#123;username&#125;,&lt;/if&gt;
      &lt;if test=&quot;password != null&quot;&gt;password=#&#123;password&#125;,&lt;/if&gt;
      &lt;if test=&quot;email != null&quot;&gt;email=#&#123;email&#125;,&lt;/if&gt;
      &lt;if test=&quot;bio != null&quot;&gt;bio=#&#123;bio&#125;&lt;/if&gt;
    &lt;/set&gt;
  where id=#&#123;id&#125;
&lt;/update&gt;
</code></pre>
<p>&#x3D;&#x3D;<strong>所谓的动态SQL，本质还是SQL语句，只是我们可以在SQL层面，去执行一个逻辑代码</strong>&#x3D;&#x3D;</p>
<h3 id="SQL片段"><a href="#SQL片段" class="headerlink" title="SQL片段"></a>SQL片段</h3><p>有的时候，我们可能会将一些功能的部分抽取出来，方便复用！</p>
<ol>
<li><p>使用SQL标签抽取公共的部分</p>
<pre><code class="xml">&lt;sql id=&quot;if-title-aothor&quot;&gt;
        &lt;if test=&quot;title != null&quot;&gt;
            and title = #&#123;title&#125;
        &lt;/if&gt;
        &lt;if test=&quot;author != null&quot;&gt;
            and author = #&#123;author&#125;
        &lt;/if&gt;
    &lt;/sql&gt;
</code></pre>
</li>
<li><p>在需要使用的地方使用<code>include</code>标签引用即可</p>
<pre><code class="xml">&lt;select id=&quot;querBlogIF&quot; parameterType=&quot;map&quot; resultType=&quot;Bloginfo&quot;&gt;
        select * from blog 
        &lt;where&gt;
            &lt;include refid=&quot;if-title-aothor&quot;/&gt;
        &lt;/where&gt;
    &lt;/select&gt;
</code></pre>
<p>注意事项：</p>
<ul>
<li>最好基于单表来定义SQL片段！</li>
<li>不要存在where标签</li>
</ul>
</li>
</ol>
<h3 id="foreach"><a href="#foreach" class="headerlink" title="foreach"></a>foreach</h3><pre><code class="xml">select * from user where 1 = 1 and 

&lt;foreach item=&quot;id&quot; collection=&quot;ids&quot;
      open=&quot;(&quot; separator=&quot;or&quot; close=&quot;)&quot;&gt;
        #&#123;id&#125;
  &lt;/foreach&gt;

(id = 1 or id = 2 or id = 3)
</code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/ISDAY/FigureBed/image-20220711223613391.png" alt="image-20220711223613391"></p>
<p><img src="https://cdn.jsdelivr.net/gh/ISDAY/FigureBed/image-20220711224134688.png" alt="image-20220711224134688"></p>
<pre><code class="xml">   &lt;!--
         select * from user where 1 = 1 and (id = 1 or id = 2 or id = 3)

         我们现在传递一个万能的map，这map中可以存在一个集合！
    --&gt;
    &lt;select id=&quot;queryBlogForeach&quot; parameterType=&quot;map&quot; resultType=&quot;Bloginfo&quot;&gt;
        select * from blog
        &lt;where&gt;
            &lt;foreach collection=&quot;ids&quot; item=&quot;id&quot; open=&quot;(&quot; close=&quot;)&quot; separator=&quot;or&quot;&gt;
               id = #&#123;id&#125;
            &lt;/foreach&gt;
        &lt;/where&gt;
    &lt;/select&gt;
</code></pre>
<p>&#x3D;&#x3D;动态SQL就是在拼接SQL语句，我们只要保证SQL的正确性，按照SQL的格式，去排列组合就可以了!&#x3D;&#x3D;</p>
<p>建议：</p>
<ul>
<li>先在MySQL中写出完整的SQL，再对应的去修改成为我们的动态SQL实现通用即可！</li>
</ul>
<h2 id="13、缓存"><a href="#13、缓存" class="headerlink" title="13、缓存"></a>13、缓存</h2><h3 id="13-1、简介"><a href="#13-1、简介" class="headerlink" title="13.1、简介"></a>13.1、简介</h3><pre><code>查询	：	连接数据库 ，耗资源！
    一次查询的结果，给他暂存在一个可以直接取到的地方！---&gt;内存·：缓存
    
我们再次查询相同数据的时候，直接走缓存，就不用走数据库了
</code></pre>
<ol>
<li>什么是缓存 [ Cache ]?<ul>
<li>存在内存中的临时数据。</li>
<li>将用户经常查询的数据放在缓存（内存）中，用户去查询数据就不用从磁盘上（关系型数据库数据文件）查询，从缓存中查询；从而提高查询效率，解决了高并发系统的性能问题。</li>
</ul>
</li>
<li>为什么使用缓存？<ul>
<li>减少和数据库的交互次数，减少系统开销，提高系统效率。</li>
</ul>
</li>
<li>什么样的数据能使用缓存？<ul>
<li>经常查询并且不经常改变的数据。</li>
</ul>
</li>
</ol>
<h3 id="13-2、MyBatis缓存"><a href="#13-2、MyBatis缓存" class="headerlink" title="13.2、MyBatis缓存"></a>13.2、MyBatis缓存</h3><ul>
<li>MyBatis包含一个非常强大的查询缓存特性，它可以非常方便地定制和配置缓存，缓存可以极的提升查询效率。</li>
<li>MyBatis系统中默认定义了两级缓存：<strong>一级缓存</strong>和<strong>二级缓存</strong><ul>
<li>默认情况下，只有一级缓存开启。（SqlSession级别的缓存，也称为本地缓存）</li>
<li>二级缓存需要手动开启和配置，它是基于namespace级别的缓存。</li>
<li>为了提高扩展性，MyBatis定义了缓存接口<code>Cache</code>。我们可以通过实习<code>Cache</code>接口来自定义二级缓存</li>
</ul>
</li>
</ul>
<h3 id="13-3、一级缓存"><a href="#13-3、一级缓存" class="headerlink" title="13.3、一级缓存"></a>13.3、一级缓存</h3><ul>
<li>一级缓存也叫本地缓存：<ul>
<li>与数据库同一次会话期间查询到的数据会放在本地缓存中。</li>
<li>以后如果需要获取相同的数据，直接从缓存中拿，没必要再去查询数据库；</li>
</ul>
</li>
</ul>
<p>测试步骤：</p>
<ol>
<li><p>开启日志！</p>
</li>
<li><p>测试在一个Session中查询两次相同的记录</p>
</li>
<li><p>查看日志输出<img src="https://cdn.jsdelivr.net/gh/ISDAY/FigureBed/image-20220713203648834.png" alt="image-20220713203648834"></p>
<p>缓存失效的情况：</p>
<ol>
<li><p>查询不同的东西</p>
</li>
<li><p>增删改操作，可能会改变原来的数据，所以必定会刷新缓存！</p>
<p><img src="https://cdn.jsdelivr.net/gh/ISDAY/FigureBed/image-20220713204706301.png" alt="image-20220713204706301"></p>
</li>
<li><p>查询不同的Mapper.xml</p>
</li>
<li><p>手动清除缓存！<img src="https://cdn.jsdelivr.net/gh/ISDAY/FigureBed/image-20220713204903410.png" alt="image-20220713204903410"></p>
</li>
</ol>
</li>
</ol>
<p>小结：一级缓存默认市开启的，只在一次SqlSession中有效，也就是拿到连接到关闭连接这个区间段！</p>
<p>一级缓存就是一个Map。</p>
<h3 id="13-4、二级缓存"><a href="#13-4、二级缓存" class="headerlink" title="13.4、二级缓存"></a>13.4、二级缓存</h3><ul>
<li>二级缓存也叫全局缓存，一级缓存作用域太低了，所以诞生了二级缓存</li>
<li>基于namespace级别的缓存，一个名称空间，对应一个二级缓存；</li>
<li>工作机制<ul>
<li>一个会话查询一条数据，这个数据就会被放在当前会话的一级缓存中；</li>
<li>如果当前会话关闭了，这个会话对应的一级缓存就没了；但是我们想要的是，会话关闭了，一级缓存中的数据被保存到二级缓存中；</li>
<li>新的会话查询信息，就可以从二级缓存中获取内容；</li>
<li>不同的mapper查处的数据会放在自己对应的缓存（map）中；</li>
</ul>
</li>
</ul>
<p>步骤：</p>
<ol>
<li><p>开启全局缓存</p>
<pre><code class="xml">        &lt;!--显示的开启全局缓存--&gt;
        &lt;setting name=&quot;cacheEnabled&quot; value=&quot;true&quot;/&gt;
</code></pre>
</li>
<li><p>在要使用二级缓存的Mapper中开启</p>
<pre><code class="xml">    &lt;!--在当前Mapper.xml中使用二级缓存--&gt;
    &lt;cache/&gt;
</code></pre>
<p>也可以自定义参数</p>
<pre><code class="xml">    &lt;!--在当前Mapper.xml中使用二级缓存--&gt;
    &lt;cache eviction=&quot;FIFO&quot;
           flushInterval=&quot;60000&quot;
           size=&quot;512&quot;
           readOnly=&quot;true&quot;/&gt;
</code></pre>
</li>
<li><p>测试：</p>
<ol>
<li><p>问题：我们需要将实体类序列化！否者就会报错！</p>
<p><img src="https://cdn.jsdelivr.net/gh/ISDAY/FigureBed/image-20220713211107966.png" alt="image-20220713211107966"></p>
</li>
</ol>
</li>
</ol>
<p>小结：</p>
<ul>
<li>只要开启了二级缓存，在同一个Mapper下就有效</li>
<li>所有的数据都会先放在一级缓存中；</li>
<li>只有当会话提交，或者关闭的时候，才会提交到二级缓存中！</li>
</ul>
<h3 id="13-5、缓存原理"><a href="#13-5、缓存原理" class="headerlink" title="13.5、缓存原理"></a>13.5、缓存原理</h3><p><img src="https://cdn.jsdelivr.net/gh/ISDAY/FigureBed/image-20220713212611022.png" alt="image-20220713212611022"></p>
<h3 id="13-6、自定义缓存-ehcache"><a href="#13-6、自定义缓存-ehcache" class="headerlink" title="13.6、自定义缓存-ehcache"></a>13.6、自定义缓存-ehcache</h3><pre><code>Ehcache是一种广泛使用的开源Java分布式缓存。主要面向通用缓存
</code></pre>
<p>要在程序中使用ehcache，先要导包！</p>
<pre><code class="xml">&lt;!-- https://mvnrepository.com/artifact/org.mybatis.caches/mybatis-ehcache --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.mybatis.caches&lt;/groupId&gt;
    &lt;artifactId&gt;mybatis-ehcache&lt;/artifactId&gt;
    &lt;version&gt;1.2.2&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
<p>在mapper中指定使用我们的ehcache缓存实现！</p>
<p>ehcache.xml</p>
<pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;
&lt;ehcache xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
         xsi:noNamespaceSchemaLocation=&quot;http://ehcache.org/ehcache.xsd&quot;
         updateCheck=&quot;false&quot;&gt;
    &lt;!--
        diskStore:为缓存路径，ehcache分为内存和磁盘两级，此属性定义磁盘的缓存位置。参数解释如下:
        user.home - 用户主目录
        user.dir  - 用户当前工作目录
        Java.io.tmpdir - 默认临时文件路径
    --&gt;
    &lt;diskStore path=&quot;./tmpdir/Tmp_EhCache&quot;/&gt;

    &lt;defaultCache
        eternal=&quot;false&quot;
        maxElementsInMemory=&quot;10000&quot;
        overflowToDisk=&quot;false&quot;
        diskPersistent=&quot;false&quot;
        timeToIdleSeconds=&quot;1800&quot;
        timeToLiveSeconds=&quot;259200&quot;
        memoryStoreEvictionPolicy=&quot;LRU&quot;/&gt;

    &lt;cache
            name=&quot;cloud_user&quot;
            eternal=&quot;false&quot;
            maxElementsInMemory=&quot;5000&quot;
            overflowToDisk=&quot;false&quot;
            diskPersistent=&quot;false&quot;
            timeToIdleSeconds=&quot;1800&quot;
            timeToLiveSeconds=&quot;1800&quot;
            memoryStoreEvictionPolicy=&quot;LRU&quot;/&gt;
    &lt;!--
        defaultCache:默认缓存策略，当cache找不到定义的缓存时，则使用这个缓存策略。只能定义一个。
    --&gt;
    &lt;!--
        name:缓存名称
        maxElementsInMemory:缓存最大数目
        maxElementsOnDisk:硬盘最大缓存个数
        eternal:对象是否永久有效，一但设置了timeout将不起作用
        overflowToDisk:是否保存到磁盘，当系统宕机时
        timeToIdleSeconds:设置对象在失效前的允许闲置时间（单位：秒）。仅当eternal=false对象不是永久有效时使用，可选属性，默认值是0，也就是可闲置时间无穷大。
        timeToLiveSeconds:设置对象在失效前允许存活时间（单位：秒）。最大时间介于创建时间和失效时间之间。仅当eternal=false对象不是永久有效时使用，默认是0.，也就是对象存活时间无穷
        diskPersistent:是否缓存虚拟机重启期数据 Whether the disk store persists between restarts of the Virtual Machine. The default value is false.
        diskSpoolBufferSizeMB:这个参数设置DiskStore（磁盘缓存）的缓存区大小。默认是30MB。每个Cache都应该有自己的一个缓冲区。
        diskExpiryThreadIntervalSeconds:磁盘失效线程运行时间间隔，默认是120秒。
        memoryStoreEvictionPolicy:当达到maxElementsInMemory限制时，Ehcache将会根据指定的策略去清理内存。默认策略是LRU（最近最少使用）。你可以设置为FIFO（先进先出）或是LFU（较少使用）。
        clearOnFlush:内存数量最大时是否清除。
        memoryStoreEvictionPolicy:可选策略有:LRU（最近最少使用，默认策略）、FIFO（先进先出）、LFU（最少访问次数）。
        FIFO，first in first out，这个是大家最熟的，先进先出。
        LFU，Less Frequently Used，就是上面例子中使用的策略，直白一点就是讲一直以来最少被使用的。如上面所讲，缓存的元素有一个hit属性，hit值最小的将会被清除缓存。
        LRU，Least Recently Used，最近最少使用，缓存的元素有一个时间戳，当缓存容量满了，而又需要腾出地方来缓存新的元素的时候，那么现有缓存元素中时间戳离当前时间最远的元素将被清除缓存。
    --&gt;

    
&lt;/ehcache&gt;
</code></pre>
<p>Redis数据库来做缓存！</p>

    </div>
    
    <link rel="stylesheet" href="https://cdn.staticfile.org/gitalk/1.7.2/gitalk.min.css">
    <div id="comment">
        <div id="gitalk-container"></div>
    </div>
    
    
</div>
                         
<footer id="footer">
    <div class="footer-wrap">
        <div>
            © 2022 - 2022 ISDAY
            <span class="footer-icon">
                <i class="fa-solid fa-font-awesome fa-fw"></i>
            </span>
            @ISDAY
        </div>
        <div></div>
        <div>Based on the <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo Engine</a> & <a
                target="_blank" rel="noopener" href="https://github.com/argvchs/hexo-theme-particlex">ParticleX Theme</a></div>

    </div>
</footer>
                    </div>
                </div>
            </transition>
            <div id="img_show">
                <img id="img_content" alt="img_show">
            </div>
        </div>
        <script src="https://cdn.staticfile.org/highlight.js/11.5.1/highlight.min.js"></script>
        <script src="/js/particlex.js"></script>
        <script src="/js/showimg.js"></script>
        
<script src="https://cdn.staticfile.org/gitalk/1.7.2/gitalk.min.js"></script>
<script>
    var clientID = "", clientSecret = "";
    
    const gitalk = new Gitalk({
        clientID: clientID,
        clientSecret: clientSecret,
        repo: "",
        owner: "",
        admin: [""],
        language: "zh-CN",
        id: location.pathname,
        distractionFreeMode: false,
        
    })
    gitalk.render("gitalk-container")
</script>


    </body>
</html>